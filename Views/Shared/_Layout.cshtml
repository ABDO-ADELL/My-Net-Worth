<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - PRISM</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
        @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <a href="@Url.Action("Index", "Dashboard")" class="sidebar-brand">
            <i class="fas fa-gem"></i>
            <span class="sidebar-brand-text">PRISM</span>
        </a>

        <ul class="sidebar-menu">
            <!-- Dashboard -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Dashboard")" class="nav-link">
                    <i class="fas fa-th-large"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
            </li>

            <li class="nav-section-title">
                <span class="nav-text">MANAGEMENT</span>
            </li>

            <!-- Orders -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Order")" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="nav-text">Orders</span>
                </a>
            </li>

            <!-- Businesses -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Business")" class="nav-link">
                    <i class="fas fa-building"></i>
                    <span class="nav-text">Businesses</span>
                </a>
            </li>

            <!-- Branches -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Branch")" class="nav-link">
                    <i class="fas fa-store"></i>
                    <span class="nav-text">Branches</span>
                </a>
            </li>

            <!-- Item Categories -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "ItemCategories")" class="nav-link">
                    <i class="fas fa-tags"></i>
                    <span class="nav-text">Item Categories</span>
                </a>
            </li>

            <!-- Items -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Items")" class="nav-link">
                    <i class="fas fa-box"></i>
                    <span class="nav-text">Items</span>
                </a>
            </li>

            <!-- Customers -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Customer")" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span class="nav-text">Customers</span>
                </a>
            </li>

            <!-- Suppliers -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Suppliers")" class="nav-link">
                    <i class="fas fa-truck"></i>
                    <span class="nav-text">Suppliers</span>
                </a>
            </li>

            <li class="nav-section-title">
                <span class="nav-text">FINANCIAL</span>
            </li>

            <!-- Expenses -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Expenses", new { businessId = 1 })" class="nav-link">
                    <i class="fas fa-money-bill-wave"></i>
                    <span class="nav-text">Expenses</span>
                </a>
            </li>

            <!-- Payments -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Payments", new { businessId = 1 })" class="nav-link">
                    <i class="fas fa-credit-card"></i>
                    <span class="nav-text">Payments</span>
                </a>
            </li>

            <!-- Reports -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Report")" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-text">Reports</span>
                </a>
            </li>

            <!-- Invoices -->
@*             <li class="nav-item">
                <a href="@Url.Action("Index", "Invoice")" class="nav-link">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span class="nav-text">Invoices</span>
                </a>
            </li>
 *@
            <li class="nav-section-title">
                <span class="nav-text">SYSTEM</span>
            </li>

@*             <!-- Settings -->
            <li class="nav-item">
                <a href="@Url.Action("Index", "Settings")" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </li>
 *@
            <!-- Account -->
            <li class="nav-item">
                <a href="@Url.Action("Profile", "Account")" class="nav-link">
                    <i class="fas fa-user-circle"></i>
                    <span class="nav-text">Account</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Top Navigation -->
    <<!-- Top Navigation -->
    <nav class="top-nav">
        <div class="top-nav-content">
            <!-- Left Section -->
            <div class="top-nav-left d-flex align-items-center gap-4">
                <!-- Sidebar Toggle -->
                <button class="toggle-sidebar" id="toggleSidebar" title="Toggle Sidebar">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- Breadcrumb Navigation -->
                <nav aria-label="breadcrumb" class="breadcrumb-nav">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a href="@Url.Action("Index", "Dashboard")" class="text-decoration-none">
                                <i class="fas fa-home me-1"></i>Home
                            </a>
                        </li>
                        @if (!string.IsNullOrEmpty(ViewData["Title"]?.ToString()))
                        {
                            <li class="breadcrumb-item active" aria-current="page">
                                @ViewData["Title"]
                            </li>
                        }
                    </ol>
                </nav>
            </div>

            <!-- Right Section -->
            <div class="top-nav-right d-flex align-items-center gap-3">
                <!-- Quick Actions -->
                <div class="quick-actions d-flex align-items-center gap-2">
                    <!-- Search Button -->
                    <button class="btn btn-icon" title="Search" data-bs-toggle="modal" data-bs-target="#searchModal">
                        <i class="fas fa-search"></i>
                    </button>

                    <!-- Theme Toggle -->
                    <button class="btn btn-icon theme-toggle" title="Toggle Theme" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>

                    <!-- Notifications Dropdown -->
                    @* <div class="dropdown">
                    <button class="btn btn-icon dropdown-toggle position-relative" 
                            data-bs-toggle="dropdown" 
                            aria-expanded="false"
                            title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end notification-dropdown shadow-lg">
                        <li class="dropdown-header">
                            <h6 class="mb-0">Notifications</h6>
                            <small class="text-muted">You have 3 unread messages</small>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item d-flex align-items-start gap-3" href="#">
                                <div class="notification-icon bg-primary">
                                    <i class="fas fa-shopping-cart text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold">New Order Received</div>
                                    <small class="text-muted">2 minutes ago</small>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-start gap-3" href="#">
                                <div class="notification-icon bg-success">
                                    <i class="fas fa-check-circle text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold">Payment Completed</div>
                                    <small class="text-muted">1 hour ago</small>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item d-flex align-items-start gap-3" href="#">
                                <div class="notification-icon bg-warning">
                                    <i class="fas fa-exclamation-triangle text-white"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-semibold">Low Stock Alert</div>
                                    <small class="text-muted">5 hours ago</small>
                                </div>
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-footer">
                            <a href="#" class="dropdown-item text-center text-primary">
                                View All Notifications
                            </a>
                        </li>
                    </ul>
                </div> *@
                </div>

                <!-- User Profile -->
                @{
                    var currentUser = await UserManager.GetUserAsync(User);
                    var userRoles = currentUser != null ? await UserManager.GetRolesAsync(currentUser) : new List<string>();
                    var displayName = currentUser != null ? $"{currentUser.FirstName} {currentUser.LastName}" : "User";
                    var initials = currentUser != null ? $"{currentUser.FirstName?.FirstOrDefault()}{currentUser.LastName?.FirstOrDefault()}" : "U";
                    var role = userRoles.FirstOrDefault() ?? "User";
                }

                @if (User.Identity?.IsAuthenticated == true)
                {
                    @inject Microsoft.AspNetCore.Identity.UserManager<PRISM.Models.Authmodels.AppUser> UserManager

                    <div class="dropdown user-dropdown">
                        <button class="user-profile-btn dropdown-toggle d-flex align-items-center gap-2"
                                data-bs-toggle="dropdown"
                                aria-expanded="false"
                                title="User Menu">
                            <div class="user-avatar position-relative">
                                @initials
                                <span class="user-status bg-success"></span>
                            </div>
                            <div class="user-info text-start d-none d-md-block">
                                <div class="user-name">@displayName</div>
                                <div class="user-role text-capitalize">@role</div>
                            </div>
                        </button>

                        <ul class="dropdown-menu dropdown-menu-end shadow-lg">
                            <li class="dropdown-header">
                                <div class="d-flex align-items-center gap-2">
                                    <div class="user-avatar bg-primary">@initials</div>
                                    <div>
                                        <div class="fw-semibold">@displayName</div>
                                        <small class="text-muted text-capitalize">@role</small>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="@Url.Action("Profile", "Account")">
                                    <i class="fas fa-user me-2"></i>My Profile
                                </a>
                            </li>
@*                             <li>
                                <a class="dropdown-item" href="@Url.Action("Index", "Settings")">
                                    <i class="fas fa-cog me-2"></i>Settings
                                </a>
                            </li>
 *@                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form asp-controller="Account" asp-action="Logout" method="post" class="dropdown-item p-0">
                                    <button type="submit" class="btn btn-link text-danger dropdown-item w-100 text-start">
                                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                }
                else
                {
                    <div class="auth-buttons d-flex gap-2">
                        <a href="@Url.Action("Register", "Account")" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-user-plus me-1"></i>Register
                        </a>
                        <a href="@Url.Action("Login", "Account")" class="btn btn-primary btn-sm">
                            <i class="fas fa-sign-in-alt me-1"></i>Login
                        </a>
                    </div>
                }
            </div>
        </div>
    </nav>

    <!-- Search Modal -->
    <div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0 pb-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body pt-0">
                    <div class="search-container">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text bg-transparent border-0">
                                <i class="fas fa-search text-muted"></i>
                            </span>
                            <input type="text" class="form-control border-0 shadow-none"
                                   placeholder="Search everything..."
                                   id="globalSearch">
                        </div>
                        <div class="search-suggestions mt-3">
                            <small class="text-muted">Quick access:</small>
                            <div class="d-flex gap-2 mt-2">
                                <a href="@Url.Action("Index", "Order")" class="badge bg-light text-dark text-decoration-none">
                                    <i class="fas fa-shopping-cart me-1"></i>Orders
                                </a>
                                <a href="@Url.Action("Index", "Customer")" class="badge bg-light text-dark text-decoration-none">
                                    <i class="fas fa-users me-1"></i>Customers
                                </a>
                                <a href="@Url.Action("Index", "Report")" class="badge bg-light text-dark text-decoration-none">
                                    <i class="fas fa-chart-bar me-1"></i>Reports
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Main Content -->
    <div class="main-content">
        @RenderBody()
    </div>

    <!-- Footer -->
    <footer class="footer">
        <strong>© @DateTime.Now.Year PRISM Financial Management.</strong> All rights reserved.
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="~/js/site.js" asp-append-version="true"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>